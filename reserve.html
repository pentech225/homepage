<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>予約カレンダー</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid #ccc;
      vertical-align: top;
      width: 14.2%;
      height: 120px;
      padding: 5px;
    }

    th {
      background-color: #f5f5f5;
    }

    .date-label {
      font-weight: bold;
    }

    .time-slot {
      display: block;
      margin: 2px 0;
      font-size: 12px;
      padding: 2px;
      background-color: #e0f7fa;
      border: 1px solid #00acc1;
      border-radius: 3px;
      text-align: center;
      cursor: pointer;
    }

    .reserved {
      background-color: #ccc !important;
      color: #666;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>予約カレンダー（月・時間選択）</h1>
  <div id="calendar"></div>

  <script>
    const reservations = {}; // 予約情報を記録

    function generateCalendar() {
      const calendar = document.getElementById("calendar");
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const totalDays = lastDay.getDate();

      const slots = Array.from({ length: 9 }, (_, i) => `${i + 9}:00`);

      let html = `<h2>${year}年 ${month + 1}月</h2>`;
      html += `<table><tr><th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th></tr><tr>`;

      for (let i = 0; i < startDay; i++) {
        html += `<td></td>`;
      }

      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        html += `<td><div class="date-label">${day}</div>`;

        slots.forEach(time => {
          const slotId = `${dateStr} ${time}`;
          const reserved = reservations[slotId] ? "reserved" : "";
          html += `<div class="time-slot ${reserved}" onclick="reserveSlot('${slotId}')">${time}</div>`;
        });

        html += `</td>`;
        if ((startDay + day) % 7 === 0) html += `</tr><tr>`;
      }

      html += `</tr></table>`;
      calendar.innerHTML = html;
    }

    function reserveSlot(slotId) {
      if (reservations[slotId]) {
        alert("すでに予約済みです。");
        return;
      }

      const name = prompt(`${slotId} を予約します。お名前を入力してください:`);
      if (!name) return;

      reservations[slotId] = name;
      alert(`${slotId} を ${name} さんで予約しました！`);
      generateCalendar(); // 表示更新
    }

    generateCalendar();
  </script>
</body>
</html>